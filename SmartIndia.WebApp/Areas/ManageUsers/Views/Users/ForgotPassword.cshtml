
@{
    ViewData["Title"] = "ForgotPassword";
    Layout = "~/Views/Shared/_LayoutLogin.cshtml";
}
@section Scripts{
    <script src="~/ApplicationScripts/Common/custom-validate.js"></script>
    <script src="~/ApplicationScripts/Common/mail-gateway.js"></script>
    <script>
        $(document).ready(function () {
            $('#txtEmail').focus();
            $("#MyForm").keypress(function (e) {
                kCode = e.keyCode || e.charCode //for cross browser
                if (kCode == 13) {
                    var defaultbtn = $(this).attr("DefaultButton");
                    $("#" + defaultbtn).click();
                    return false;
                }
            });
        });
        function ValidateForm() {
            if (!BlankTextBox('txtEmail', 'Email')) {
                return false;
            }
            else if (!ValidateEmail('txtEmail')) {
                return false;
            }
            else if (!IsSpecialCharacter1stPalce('txtEmail')) {
                return false;
            }
            else {
                return true;
            }
        } 
        $('#btnSubmit').click(function () {
            if (ValidateForm()) {
                CallSave();
            }
            function CallSave() {
                $.ajax({
                    url: ServiceURL + "/api/UserRegistration/CheckValidEmail?email=" + $('#txtEmail').val(),
                    type: "GET",
                    contentType: "application/json",
                    success: function (data) {
                        if (data != null) {
                            const now = new Date()
                            const itemEMail = {
                                value: generateOTP(),
                                expiry: now.getTime() + 300000,
                            }
                            localStorage.setItem("emailOTP", JSON.stringify(itemEMail));
                            localStorage.setItem("emailID", $('#txtEmail').val());
                            localStorage.setItem("firstName", data.firstName);

                            sendEmail($('#txtFirstName').val(), $('#txtEmail').val(), itemEMail.value);
                            window.location.href = "/ManageUsers/Users/EmailVerification";
                        }
                        else if (data == null) {
                            BootstrapAlert('Email ID not found.', 'txtEmail');
                        }
                        else {
                            BootstrapAlert('Something went wrong. Please try again');
                        }
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        console.log(textStatus + "\nError Tirado: \n" + errorThrown);
                    }
                });
            }
        });
    </script>
}
<div class="forgot-password-area">
    <div class="d-table">
        <div class="d-table-cell">
            <div class="forgot-password-content">
                <div class="row m-0">
                    <div class="col-lg-12 p-0">
                        <div class="forgot-password-form">
                            <h2>Recover your password</h2>
                            <p class="mb-0">Please provide your registered email address.</p>

                            <form name="forgotpassword" id="MyForm" defaultbutton='btnSubmit'>
                                <div class="form-group">
                                    <input type="email" id="txtEmail" class="form-control" name="name" placeholder="Email" maxlength="100" autocomplete="off">
                                    <span class="label-title">
                                        <i class='bx bx-envelope'></i>
                                    </span>
                                </div>
                                <input type="button" id="btnSubmit" class="forgot-password-btn" value="Submit" />
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

